let e="/";const t=new Map,a=async()=>{if(chrome.sidePanel)try{await chrome.sidePanel.setOptions({path:"src/ui/side-panel/index.html",enabled:!0}),await chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0})}catch(e){}};a();const n=async e=>{try{const t=await chrome.tabs.query({url:[`*://kylenguyen.me/*?${e}`]});if(t.length>0&&"number"==typeof t[0].id){const e=t[0];"number"==typeof e.windowId&&await chrome.windows.update(e.windowId,{focused:!0}),await chrome.tabs.update(e.id,{active:!0})}else await chrome.tabs.create({url:`https://kylenguyen.me?${e}`})}catch(t){}};chrome.runtime.onInstalled.addListener(async e=>{await a(),"install"===e.reason?(await n("?new-version-installed=true"),await(async()=>{try{const t=(await chrome.tabs.query({url:["*://labs.google/*"]})).filter(e=>e.url&&e.url.includes("/flow"));for(const a of t)if(a.id)try{await chrome.tabs.reload(a.id)}catch(e){}t.length}catch(e){}})()):"update"===e.reason&&await n("?new-version-updated=true")}),self.onerror=function(e,t,a,n,r){},chrome.action.onClicked.addListener(async e=>{if(chrome.sidePanel&&void 0!==e.id)try{await chrome.sidePanel.open({tabId:e.id})}catch(t){}}),chrome.runtime.onMessage.addListener((a,n,r)=>{switch(a.type){case"SET_ZOOM":{const{zoomFactor:e}=a;n.tab?.id?(chrome.tabs.setZoom(n.tab.id,e),r({success:!0})):r({success:!1,error:"Tab ID not found"})}break;case"DOWNLOAD_VIDEO":{const{url:e,filename:n,folder:s}=a,o=s?`${s}/${n}`:n;return t.set(e,o),chrome.downloads.download({url:e,filename:o,saveAs:!1},e=>{const t=chrome.runtime?.lastError;r(!t&&e?{success:!0,downloadId:e}:{success:!1,error:t?.message||"Failed to start download"})}),!0}case"SET_PROJECT_NAME":{const{projectName:t}=a;"string"==typeof t&&t.trim()?(e=`${t.trim()}/`,r({success:!0})):r({success:!1,error:"Invalid project name"})}}return!1}),chrome.downloads.onDeterminingFilename.addListener((a,n)=>{const r=/\.(mp4)$/i.test(a.filename||a.url),s=/\.(jpg|jpeg|png|gif|webp|bmp|svg)$/i.test(a.filename||a.url);if(!r&&!s)return;if(t.has(a.url)){return n({filename:t.get(a.url)}),void t.delete(a.url)}const o=a.filename,i=o.split("/").pop()||o;n({filename:`${e}${i}`})});
